@page
@model IndexModel
@{
    ViewData["Title"] = "Home";
}
<style>
    /* Calendar visual styling to match screenshot */
    .calendar-top {
        background: #5f9aa5;
        color: #fff;
        padding: 8px 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
    }

        .calendar-top .info {
            font-size: 0.95rem;
            display: flex;
            gap: 8px;
            align-items: center;
        }

            .calendar-top .info strong {
                margin-left: 6px;
            }

    .calendar-wrapper {
        border-top: 1px solid #e6e6e6;
        padding-top: 12px;
    }

    /* flatpickr range styling */
    .flatpickr-calendar {
        box-shadow: none;
        border: none;
    }

    .flatpickr-day.startRange, .flatpickr-day.endRange {
        background: #3f8f97 !important;
        color: #fff !important;
        border-radius: 6px !important;
    }

    .flatpickr-day.inRange {
        background: #cfe8ea !important;
        color: #000 !important;
    }

    .flatpickr-weekwrapper {
        background: #f3f3f3;
        border-right: 1px solid #e6e6e6;
    }

    .flatpickr-weekday:before {
        display: none;
    }

    /* give the two months more breathing room */
    .flatpickr-months {
        gap: 28px;
    }

    /* small tweaks for the control area */
    .calendar-controls {
        margin-top: 10px;
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }

        .calendar-controls .small {
            color: #6c757d;
        }

    /* clear button */
    #clearSelection {
        margin-left: auto;
    }
</style>

<div class="booking-page center-vertical">
    <div class="row g-4 justify-content-center w-100">
        <div class="col-11 col-sm-10 col-md-8 col-lg-7 col-xl-6">
            <div class="card calendar-card">
                <div class="card-header">Vælg periode</div>
                <div class="card-body">
                    <div class="calendar-wrapper">
                        <div class="calendar-top">
                            <div class="info">
                                <span>Ankomst: <strong id="start">—</strong></span>
                            </div>
                            <div class="info">
                                <span>Afrejse: <strong id="end">—</strong></span>
                            </div>
                        </div>

                        <div id="fp-calendar" class="mt-3"></div>

                        <div class="calendar-controls">
                            <div class="small text-muted">Dage: <strong id="days">0</strong></div>
                            <button id="clearSelection" type="button" class="btn btn-sm btn-outline-secondary">Nulstil</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/calendar.js" asp-append-version="true"></script>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    // find flatpickr instance attached to #fp-calendar
    const calEl = document.querySelector("#fp-calendar");
    if (!calEl) return;

    const fp = calEl._flatpickr || (window.flatpickr && flatpickr(calEl)[0]) || null;
    // create button and append near controls
    const controls = document.querySelector(".calendar-controls");
    if (!controls) return;

    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "btn btn-success btn-sm";
    btn.textContent = "Vælg plads";
    btn.style.marginLeft = "8px";

    btn.addEventListener("click", function () {
        if (!fp || !fp.selectedDates || fp.selectedDates.length < 2) {
            alert("Vælg venligst både ankomst og afrejse.");
            return;
        }

        // Use ISO format (YYYY-MM-DD) to keep parsing simple server-side
        const format = (d) => fp.formatDate(d, "Y-m-d"); // flatpickr token Y=4-digit year, m=month, d=day
        const start = format(fp.selectedDates[0]);
        const end = format(fp.selectedDates[1]);

        // calculate days (safe to send, but server will also compute)
        const a = new Date(fp.selectedDates[0].getFullYear(), fp.selectedDates[0].getMonth(), fp.selectedDates[0].getDate());
        const b = new Date(fp.selectedDates[1].getFullYear(), fp.selectedDates[1].getMonth(), fp.selectedDates[1].getDate());
        const days = Math.max(0, Math.round((b - a) / (1000 * 60 * 60 * 24)));

        const url = `/Accommodation?start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}&daysQuery=${encodeURIComponent(days)}`;
        window.location.href = url;
    });

    controls.appendChild(btn);
});
</script>
}